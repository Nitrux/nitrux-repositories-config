#!/bin/bash

test -f /sbin/openrc-init && {
	sed -i \
		-e 's+#deb http://archive.ubuntu.com/ubuntu focal main restricted universe multiverse+deb http://archive.ubuntu.com/ubuntu focal main restricted universe multiverse+g' \
		-e 's+#deb http://archive.ubuntu.com/ubuntu focal-security main restricted universe multiverse+deb http://archive.ubuntu.com/ubuntu focal-security main restricted universe multiverse+g' \
		-e 's+#deb http://archive.ubuntu.com/ubuntu focal-updates main restricted universe multiverse+deb http://archive.ubuntu.com/ubuntu focal-updates main restricted universe multiverse+g' \
		/etc/apt/sources.list.d/ubuntu-focal-repo.list

	sed -i \
		-e 's+deb http://archive.ubuntu.com/ubuntu bionic main restricted universe multiverse+#deb http://archive.ubuntu.com/ubuntu bionic main restricted universe multiverse+g' \
		-e 's+deb http://archive.ubuntu.com/ubuntu bionic-security main restricted universe multiverse+#deb http://archive.ubuntu.com/ubuntu bionic-security main restricted universe multiverse+g' \
		-e's+deb http://archive.ubuntu.com/ubuntu bionic-updates main restricted universe multiverse+#deb http://archive.ubuntu.com/ubuntu bionic-updates main restricted universe multiverse+g' \
		/etc/apt/sources.list.d/ubuntu-bionic-repo.list

	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: libplymouth5' \
		'Pin: release *' \
		'Pin-Priority: -1'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: dictionaries-common' \
		'Pin: release *' \
		'Pin-Priority: -1'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: bluez' \
		'Pin: release *' \
		'Pin-Priority: -1'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: pulseaudio-module-bluetooth' \
		'Pin: release *' \
		'Pin-Priority: -1'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: samba-common' \
		'Pin: release *' \
		'Pin-Priority: -1'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: libpulse-mainloop-glib0' \
		'Pin: release *' \
		'Pin-Priority: -1'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: libpulse0' \
		'Pin: release *' \
		'Pin-Priority: -1'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: libpulsedsp' \
		'Pin: release *' \
		'Pin-Priority: -1'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: pulseaudio' \
		'Pin: release *' \
		'Pin-Priority: -1'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: pulseaudio-utils' \
		'Pin: release *' \
		'Pin-Priority: -1'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: snapd' \
		'Pin: release *' \
		'Pin-Priority: -1'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: systemd' \
		'Pin: release *' \
		'Pin-Priority: -1'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: plymouth-label' \
		'Pin: release *' \
		'Pin-Priority: -1'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: plymouth-themes' \
		'Pin: release *' \
		'Pin-Priority: -1'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: cgroupfs-mount' \
		'Pin: release *' \
		'Pin-Priority: -1'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: ssl-cert' \
		'Pin: release *' \
		'Pin-Priority: -1'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: plasma-discover' \
		'Pin: release *' \
		'Pin-Priority: -1'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: plasma-discover-common' \
		'Pin: release *' \
		'Pin-Priority: -1'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: plasma-discover-backend-flatpak' \
		'Pin: release *' \
		'Pin-Priority: -1'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: *' \
		'Pin: release o=focal' \
		'Pin-Priority: 600'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: *' \
		'Pin: origin archive.ubuntu.com' \
		'Pin-Priority: 600'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: *' \
		'Pin: release o=user' \
		'Pin-Priority: 700'
	>> /etc/apt/preferences printf "%s\n" \
		'' \
		'Package: *' \
		'Pin: origin archive.neon.kde.org' \
		'Pin-Priority: 700'
} || {
	sed -i \
		-e 's+deb http://archive.ubuntu.com/ubuntu bionic main restricted universe multiverse+#deb http://archive.ubuntu.com/ubuntu bionic main restricted universe multiverse+g' \
		-e 's+deb http://archive.ubuntu.com/ubuntu bionic-security main restricted universe multiverse+#deb http://archive.ubuntu.com/ubuntu bionic-security main restricted universe multiverse+g' \
		-e's+deb http://archive.ubuntu.com/ubuntu bionic-updates main restricted universe multiverse+#deb http://archive.ubuntu.com/ubuntu bionic-updates main restricted universe multiverse+g' \
		/etc/apt/sources.list.d/ubuntu-bionic-repo.list
}

apt -qq update
